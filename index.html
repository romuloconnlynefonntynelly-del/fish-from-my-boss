<!DOCTYPE html>
<!--
  ARQUIVO: tanques_bloco1.html
  OBJETIVO:
  Este arquivo cria um mapa visual de 30 tanques (6 linhas x 5 colunas)
  no formato igual ao desenho do caderno (A–E e 1–6).

  IMPORTANTE:
  - Tudo está comentado em PORTUGUÊS.
  - Se você quiser mudar algo, leia os comentários que explicam
    para que serve cada parte.
-->
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mapa de Tanques — 6x5 (30 Tanques)</title>
  <style>
    :root{--bg:#f4fbff;--card:#fff;--accent:#0b76ff;--muted:#666}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, Arial, sans-serif;background:var(--bg);margin:0;padding:18px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:14px}

    .wrapper{display:flex;gap:20px;flex-direction:column}

    .board-card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(10,30,60,0.06)}

    /* Grid area */
    .grid-wrap{display:flex;gap:12px;align-items:flex-start}
    /* row labels */
    .rows{display:flex;flex-direction:column;gap:12px;padding:40px 6px 6px 6px}
    .row-label{height:90px;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--muted)}

    /* main grid */
    .grid{display:grid;grid-template-columns:repeat(5, minmax(110px,1fr));gap:12px;padding:8px}
    .cell{background:#fefefe;border-radius:10px;padding:8px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;border:1px solid rgba(10,10,10,0.04);cursor:pointer}
    .cell .title{font-weight:700;margin-top:6px}
    .cell .subtitle{font-size:12px;color:var(--muted);margin-top:4px}
    .cell img{width:100%;height:60px;object-fit:cover;border-radius:6px;background:#eee}

    /* column labels under grid */
    .cols{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-top:10px}
    .col-label{height:26px;display:flex;align-items:center;justify-content:center;font-weight:700}

    /* actions */
    .actions{display:flex;gap:8px;margin-top:12px}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:#fff;color:var(--accent);border:1px solid rgba(11,118,255,0.12)}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(10,10,10,0.4)}
    .modal.open{display:flex}
    .modal-content{width:95%;max-width:420px;background:#fff;padding:14px;border-radius:12px}
    .modal-content h3{margin:0 0 8px}
    .form-row{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}
    input[type=text]{padding:8px;border-radius:8px;border:1px solid #ddd}
    input[type=file]{padding:6px}
    .preview{height:140px;background:#f2f5fb;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .preview img{width:100%;height:100%;object-fit:cover}

    footer{margin-top:14px;color:var(--muted);font-size:13px}

    @media (max-width:700px){.row-label{height:70px}.cell{min-height:80px}.grid{gap:8px}}

    /* Tela inicial */
    .splash-screen{position:fixed;inset:0;background:url('a.jpeg') center/cover no-repeat, linear-gradient(135deg, rgba(102,126,234,0.7) 0%, rgba(118,75,162,0.7) 100%);background-blend-mode:overlay;display:flex;align-items:center;justify-content:center;z-index:999;transition:opacity 0.5s ease, visibility 0.5s ease}
    .splash-screen.hide{opacity:0;visibility:hidden}
    .splash-content{text-align:center;color:#fff}
    .splash-content .fish-image{width:280px;height:280px;border-radius:50%;object-fit:cover;border:6px solid rgba(255,255,255,0.3);box-shadow:0 20px 60px rgba(0,0,0,0.3);margin-bottom:30px;background:#fff}
    .splash-content h2{font-size:32px;margin:0 0 12px;font-weight:700;text-shadow:2px 2px 4px rgba(0,0,0,0.5)}
    .splash-content p{font-size:16px;margin:0 0 32px;opacity:0.9;text-shadow:1px 1px 2px rgba(0,0,0,0.5)}
    .btn-entrar{background:#fff;color:#667eea;border:0;padding:14px 40px;border-radius:50px;font-size:18px;font-weight:700;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.2);transition:transform 0.2s ease, box-shadow 0.2s ease}
    .btn-entrar:hover{transform:translateY(-2px);box-shadow:0 15px 40px rgba(0,0,0,0.3)}
    .btn-entrar:active{transform:translateY(0)}
    .main-content{display:none}
    .main-content.show{display:block}
  </style>
</head>
<body>
  <!-- Tela Inicial -->
  <div class="splash-screen" id="splashScreen">
    <div class="splash-content">
      <img src="a.jpeg" alt="Peixe Ornamental" class="fish-image" id="fishImage">
      <h2>Peixes do Meu Patrão</h2>
      <p>Gestão de peixes ornamentais</p>
      <button class="btn-entrar" id="btnEntrar">Entrar</button>
    </div>
  </div>

  <!-- Conteúdo Principal -->
  <div class="main-content" id="mainContent">
  <header>
    <div>
      <h1>Mapa de Tanques — 30 unidades (6 x 5)</h1>
      <p class="lead">Clique em qualquer célula para adicionar o nome do peixe e uma foto. Os campos ficam salvos no seu navegador.</p>
    </div>
  </header>

  <div class="wrapper">
    <div class="board-card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Bloco 1 — 30 tanques</strong>
        
      </div>

      <div style="display:flex;gap:12px;margin-top:12px;align-items:flex-start">
        <div class="rows" aria-hidden="true">
          <!-- row numbers 1..6 -->
        </div>

        <div style="flex:1">
          <div class="grid" id="grid"></div>
          <div class="cols" aria-hidden="true">
            <!-- col labels A..E -->
          </div>
        </div>
      </div>

    </div>

    <!-- Seção Paulistinha -->
    <div class="board-card" style="margin-top:20px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Paulistinha — 11 tanques (0 a 10)</strong>
      </div>

      <div style="margin-top:12px">
        <div class="grid" id="gridPaulistinha" style="grid-template-columns:repeat(6, minmax(110px,1fr))"></div>
      </div>
    </div>

    <!-- Seção Guppy -->
    <div class="board-card" style="margin-top:20px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Guppy — 14 tanques (11-18, Z-U)</strong>
      </div>

      <div style="margin-top:12px">
        <div class="grid" id="gridGuppy" style="grid-template-columns:repeat(7, minmax(110px,1fr))"></div>
      </div>
    </div>

    <!-- Seção Bandeira -->
    <div class="board-card" style="margin-top:20px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Bandeira — 13 tanques (A-M)</strong>
      </div>

      <div style="margin-top:12px">
        <div class="grid" id="gridBandeira" style="grid-template-columns:repeat(7, minmax(110px,1fr))"></div>
      </div>
    </div>

    <!-- Seção Carpa -->
    <div class="board-card" style="margin-top:20px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Carpa — 6 tanques (N-S)</strong>
      </div>

      <div style="margin-top:12px">
        <div class="grid" id="gridCarpa" style="grid-template-columns:repeat(6, minmax(110px,1fr))"></div>
      </div>
    </div>

    <!-- Seção Filhotes de Beta e Reprodução -->
    <div class="board-card" style="margin-top:20px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Filhotes de Beta e Reprodução — 28 tanques</strong>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px;align-items:flex-start">
        <div style="display:flex;flex-direction:column;gap:12px;padding:6px">
          <div style="height:90px;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--muted)">A</div>
          <div style="height:90px;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--muted)">B</div>
          <div style="height:90px;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--muted)">C</div>
          <div style="height:90px;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--muted)">D</div>
          <div style="height:90px;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--muted)">E</div>
        </div>
        <div style="flex:1">
          <div id="gridBeta"></div>
        </div>
      </div>
    </div>

    <footer>
      <div>Observação: os dados são salvos localmente no navegador (localStorage). Se quiser, depois eu te mostro como guardar num servidor.</div>
    </footer>
  </div>

  <!-- Modal de edição -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3 id="modalTitle">Editar tanque</h3>
      <div class="form-row">
        <label>Nome do Peixe (você deixa em branco se quiser)</label>
        <input type="text" id="fishName" placeholder="Ex.: Betta, Tilápia..." />
      </div>
      <div class="form-row">
        <label>Foto do Peixe (opcional)</label>
        <input type="file" id="fishImage" accept="image/*" />
      </div>
      <div class="form-row">
        <div class="preview" id="imagePreview">Sem imagem</div>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button id="saveBtn">Salvar</button>
        <button id="cancelBtn" class="ghost">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    // Controle da tela inicial
    const splashScreen = document.getElementById('splashScreen');
    const mainContent = document.getElementById('mainContent');
    const btnEntrar = document.getElementById('btnEntrar');

    btnEntrar.addEventListener('click', ()=>{
      splashScreen.classList.add('hide');
      setTimeout(()=>{
        mainContent.classList.add('show');
      }, 500);
    });

    // Configuração: linhas e colunas para ter 30 tanques -> 6 linhas x 5 colunas (A..E)
    const rowsCount = 6;
    const cols = ['A','B','C','D','E'];
    const gridEl = document.getElementById('grid');
    const rowsEl = document.querySelector('.rows');
    const colsEl = document.querySelector('.cols');

    // cria labels das linhas
    for(let r=1;r<=rowsCount;r++){
      const div = document.createElement('div');
      div.className='row-label';
      div.textContent = r;
      rowsEl.appendChild(div);
    }

    // cria labels de colunas A..E
    cols.forEach(c=>{
      const d = document.createElement('div'); d.className='col-label'; d.textContent=c; colsEl.appendChild(d);
    });

    // dados na memória (inicial)
    let data = {};

    // Carrega de localStorage se existir
    const STORAGE_KEY = 'tanques_6x5_v1';
    const saved = localStorage.getItem(STORAGE_KEY);
    if(saved){ try{ data = JSON.parse(saved); }catch(e){ data = {}; } }
    
    // Inicializa todos os tanques com os peixes ornamentais e suas fotos
    if(!Object.keys(data).length){
      data = {
        '1A': { name: 'Molinésia Gold Black', image: '30/molinesia gold black.webp' },
        '2A': { name: 'Platy Pingo de Ouro', image: '30/Platy Pingo de Ouro.webp' },
        '3A': { name: 'Espada Abacaxi', image: '30/espada abacaxi.webp' },
        '4A': { name: 'Molinésia Prata', image: '30/Molinésia Prata.webp' },
        '5A': { name: 'Platy azul', image: '30/Platy azul.webp' },
        '6A': { name: 'Molinésia Tangerina', image: '30/molinesia-tangerina.jpg' },
        '1B': { name: 'Espada Tricolor', image: '30/espada tricolor.jpg' },
        '2B': { name: 'Filhotes' },
        '3B': { name: 'Molinésia Balão Prata', image: '30/Molinésia Balão Prata.webp' },
        '4B': { name: 'Platy Rubi', image: '30/Platy Rubi.webp' },
        '5B': { name: 'Filhotes' },
        '6B': { name: 'Espada Bicolor Albino', image: '30/Espada Bicolor Albino.webp' },
        '1C': { name: 'Molinésia Dálmata', image: '30/Molinésia Dálmata.webp' },
        '2C': { name: 'Platy Sunset', image: '30/Platy Sunset.webp' },
        '3C': { name: 'Molinésia Balão Dálmata', image: '30/Molinésia Balão Dálmata.webp' },
        '4C': { name: 'Espada Sangue', image: '30/Espada Sangue.webp' },
        '5C': { name: 'Platy Véu', image: '30/Platy Véu.webp' },
        '6C': { name: 'Molinésia Milk', image: '30/Molinésia Milk.webp' },
        '1D': { name: 'Espada Lira', image: '30/Espada Lira.webp' },
        '2D': { name: 'Livre' },
        '3D': { name: 'Platy Abelhinha', image: '30/Platy Abelhinha.webp' },
        '4D': { name: 'Molinesia tigre', image: '30/Molinesia tigre.webp' },
        '5D': { name: 'Livre' },
        '6D': { name: 'Platy tricolor', image: '30/Platy tricolor.webp' },
        '1E': { name: 'Platy Hawai', image: '30/Platy Hawai.webp' },
        '2E': { name: 'Molinésia Negra Lira', image: '30/Molinésia Negra Lira.webp' },
        '3E': { name: 'Livre' },
        '4E': { name: 'Livre' },
        '5E': { name: 'Molinesia negra', image: '30/Molinesia negra.webp' },
        '6E': { name: 'Livre' }
      };
    }

    // Cria 30 células
    for(let r=1;r<=rowsCount;r++){
      for(let ci=0;ci<cols.length;ci++){
        const col = cols[ci];
        const id = `${r}${col}`; // por exemplo 1A, 1B, ... 6E

        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.id = id;

        const img = document.createElement('img');
        img.alt = `Tanque ${id}`;
        img.src = data[id] && data[id].image ? data[id].image : '';
        if(!img.src) img.style.display='none';

        const title = document.createElement('div'); title.className='title'; title.textContent = `Tanque ${id}`;
        const subtitle = document.createElement('div'); subtitle.className='subtitle'; subtitle.textContent = data[id] && data[id].name ? data[id].name : '— (vazio)';

        cell.appendChild(img);
        cell.appendChild(title);
        cell.appendChild(subtitle);

        // Ao clicar, abre modal para editar
        cell.addEventListener('click', ()=> openModal(id, subtitle, img));

        gridEl.appendChild(cell);
      }
    }

    // ============ SEÇÃO PAULISTINHA (0 a 10) ============
    const gridPaulistinha = document.getElementById('gridPaulistinha');
    let dataPaulistinha = {};
    
    const STORAGE_KEY_PAULISTINHA = 'tanques_paulistinha_v1';
    const savedPaulistinha = localStorage.getItem(STORAGE_KEY_PAULISTINHA);
    if(savedPaulistinha){ try{ dataPaulistinha = JSON.parse(savedPaulistinha); }catch(e){ dataPaulistinha = {}; } }

    // Cria 11 tanques (0 a 10) para Paulistinha
    for(let i=0; i<=10; i++){
      const id = `P${i}`; // P0, P1, P2, ... P10

      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.id = id;

      const img = document.createElement('img');
      img.alt = `Tanque ${i}`;
      img.src = dataPaulistinha[id] && dataPaulistinha[id].image ? dataPaulistinha[id].image : '';
      if(!img.src) img.style.display='none';

      const title = document.createElement('div'); title.className='title'; title.textContent = `Tanque ${i}`;
      const subtitle = document.createElement('div'); subtitle.className='subtitle'; subtitle.textContent = dataPaulistinha[id] && dataPaulistinha[id].name ? dataPaulistinha[id].name : '— (vazio)';

      cell.appendChild(img);
      cell.appendChild(title);
      cell.appendChild(subtitle);

      // Ao clicar, abre modal para editar
      cell.addEventListener('click', ()=> openModalPaulistinha(id, subtitle, img));

      gridPaulistinha.appendChild(cell);
    }

    // ============ SEÇÃO GUPPY (11-18, Z-U) ============
    const gridGuppy = document.getElementById('gridGuppy');
    let dataGuppy = {};
    
    const STORAGE_KEY_GUPPY = 'tanques_guppy_v1';
    const savedGuppy = localStorage.getItem(STORAGE_KEY_GUPPY);
    if(savedGuppy){ try{ dataGuppy = JSON.parse(savedGuppy); }catch(e){ dataGuppy = {}; } }

    // Lista de IDs dos tanques Guppy: 11, 12, 13, 14, 15, 16, 17, 18, Z, Y, X, W, V, U
    const guppyTanks = [11, 12, 13, 14, 15, 16, 17, 18, 'Z', 'Y', 'X', 'W', 'V', 'U'];

    guppyTanks.forEach(tankNum => {
      const id = `G${tankNum}`; // G11, G12, ..., GZ, GY, etc.

      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.id = id;

      const img = document.createElement('img');
      img.alt = `Tanque ${tankNum}`;
      img.src = dataGuppy[id] && dataGuppy[id].image ? dataGuppy[id].image : '';
      if(!img.src) img.style.display='none';

      const title = document.createElement('div'); title.className='title'; title.textContent = `Tanque ${tankNum}`;
      const subtitle = document.createElement('div'); subtitle.className='subtitle'; subtitle.textContent = dataGuppy[id] && dataGuppy[id].name ? dataGuppy[id].name : '— (vazio)';

      cell.appendChild(img);
      cell.appendChild(title);
      cell.appendChild(subtitle);

      // Ao clicar, abre modal para editar
      cell.addEventListener('click', ()=> openModalGuppy(id, subtitle, img));

      gridGuppy.appendChild(cell);
    });

    // ============ SEÇÃO BANDEIRA (A-M) ============
    const gridBandeira = document.getElementById('gridBandeira');
    let dataBandeira = {};
    
    const STORAGE_KEY_BANDEIRA = 'tanques_bandeira_v1';
    const savedBandeira = localStorage.getItem(STORAGE_KEY_BANDEIRA);
    if(savedBandeira){ try{ dataBandeira = JSON.parse(savedBandeira); }catch(e){ dataBandeira = {}; } }

    // Lista de IDs dos tanques Bandeira: A, B, C, D, E, F, G, H, I, J, K, L, M
    const bandeiraLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M'];

    bandeiraLetters.forEach(letter => {
      const id = `B${letter}`; // BA, BB, BC, etc.

      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.id = id;

      const img = document.createElement('img');
      img.alt = `Tanque ${letter}`;
      img.src = dataBandeira[id] && dataBandeira[id].image ? dataBandeira[id].image : '';
      if(!img.src) img.style.display='none';

      const title = document.createElement('div'); title.className='title'; title.textContent = `Tanque ${letter}`;
      const subtitle = document.createElement('div'); subtitle.className='subtitle'; subtitle.textContent = dataBandeira[id] && dataBandeira[id].name ? dataBandeira[id].name : '— (vazio)';

      cell.appendChild(img);
      cell.appendChild(title);
      cell.appendChild(subtitle);

      // Ao clicar, abre modal para editar
      cell.addEventListener('click', ()=> openModalBandeira(id, subtitle, img));

      gridBandeira.appendChild(cell);
    });

    // ============ SEÇÃO CARPA (N-S) ============
    const gridCarpa = document.getElementById('gridCarpa');
    let dataCarpa = {};
    
    const STORAGE_KEY_CARPA = 'tanques_carpa_v1';
    const savedCarpa = localStorage.getItem(STORAGE_KEY_CARPA);
    if(savedCarpa){ try{ dataCarpa = JSON.parse(savedCarpa); }catch(e){ dataCarpa = {}; } }

    // Lista de IDs dos tanques Carpa: N, O, P, Q, R, S
    const carpaLetters = ['N', 'O', 'P', 'Q', 'R', 'S'];

    carpaLetters.forEach(letter => {
      const id = `C${letter}`; // CN, CO, CP, CQ, CR, CS

      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.id = id;

      const img = document.createElement('img');
      img.alt = `Tanque ${letter}`;
      img.src = dataCarpa[id] && dataCarpa[id].image ? dataCarpa[id].image : '';
      if(!img.src) img.style.display='none';

      const title = document.createElement('div'); title.className='title'; title.textContent = `Tanque ${letter}`;
      const subtitle = document.createElement('div'); subtitle.className='subtitle'; subtitle.textContent = dataCarpa[id] && dataCarpa[id].name ? dataCarpa[id].name : '— (vazio)';

      cell.appendChild(img);
      cell.appendChild(title);
      cell.appendChild(subtitle);

      // Ao clicar, abre modal para editar
      cell.addEventListener('click', ()=> openModalCarpa(id, subtitle, img));

      gridCarpa.appendChild(cell);
    });

    // ============ SEÇÃO FILHOTES DE BETA E REPRODUÇÃO ============
    const gridBeta = document.getElementById('gridBeta');
    let dataBeta = {};
    
    const STORAGE_KEY_BETA = 'tanques_beta_v1';
    const savedBeta = localStorage.getItem(STORAGE_KEY_BETA);
    if(savedBeta){ try{ dataBeta = JSON.parse(savedBeta); }catch(e){ dataBeta = {}; } }

    // Organiza tanques Beta por linhas: A, B, C, D, E
    const betaRows = {
      'A': ['A1', 'A2', 'A3', 'A4', 'A5'],
      'B': ['B1', 'B2', 'B3', 'B4', 'B5'],
      'C': ['C1', 'C2', 'C3', 'C4', 'C5'],
      'D': ['D1', 'D2', 'D3', 'D4', 'D5'],
      'E': ['E1', 'E2', 'E3', 'E4', 'E5', 'E6', 'E7', 'E8']
    };

    Object.keys(betaRows).forEach(rowLetter => {
      const rowDiv = document.createElement('div');
      rowDiv.style.display = 'grid';
      rowDiv.style.gridTemplateColumns = 'repeat(8, minmax(110px,1fr))';
      rowDiv.style.gap = '12px';
      rowDiv.style.marginBottom = '12px';

      betaRows[rowLetter].forEach(tankNum => {
        const id = `BT${tankNum}`; // BTA1, BTA2, etc.

        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.id = id;

        const img = document.createElement('img');
        img.alt = `Tanque ${tankNum}`;
        img.src = dataBeta[id] && dataBeta[id].image ? dataBeta[id].image : '';
        if(!img.src) img.style.display='none';

        const title = document.createElement('div'); title.className='title'; title.textContent = `Tanque ${tankNum}`;
        const subtitle = document.createElement('div'); subtitle.className='subtitle'; subtitle.textContent = dataBeta[id] && dataBeta[id].name ? dataBeta[id].name : '— (vazio)';

        cell.appendChild(img);
        cell.appendChild(title);
        cell.appendChild(subtitle);

        // Ao clicar, abre modal para editar
        cell.addEventListener('click', ()=> openModalBeta(id, subtitle, img));

        rowDiv.appendChild(cell);
      });

      gridBeta.appendChild(rowDiv);
    });

    // Modal controls
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const fishName = document.getElementById('fishName');
    const fishImage = document.getElementById('fishImage');
    const imagePreview = document.getElementById('imagePreview');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    let currentId = null;
    let currentPreviewDataUrl = null;
    let isPaulistinha = false;

    function openModal(id, subtitleEl, imgEl){
      currentId = id;
      isPaulistinha = false;
      modalTitle.textContent = `Editar ${id}`;
      fishName.value = (data[id] && data[id].name) ? data[id].name : '';
      currentPreviewDataUrl = (data[id] && data[id].image) ? data[id].image : null;
      renderPreview();
      fishImage.value = null;
      modal.classList.add('open');

      // Foca no input
      setTimeout(()=>fishName.focus(),150);

      // save handler
      saveBtn.onclick = ()=>{
        const name = fishName.value.trim();
        if(currentPreviewDataUrl){
          data[currentId] = { name: name, image: currentPreviewDataUrl };
        } else if(name){
          data[currentId] = { name: name };
        } else {
          // sem nome e sem imagem => remove
          delete data[currentId];
        }
        writeToCell(currentId);
        saveToLocal();
        closeModal();
      };
    }

    function openModalPaulistinha(id, subtitleEl, imgEl){
      currentId = id;
      isPaulistinha = true;
      modalTitle.textContent = `Editar Tanque ${id.replace('P','')}`;
      fishName.value = (dataPaulistinha[id] && dataPaulistinha[id].name) ? dataPaulistinha[id].name : '';
      currentPreviewDataUrl = (dataPaulistinha[id] && dataPaulistinha[id].image) ? dataPaulistinha[id].image : null;
      renderPreview();
      fishImage.value = null;
      modal.classList.add('open');

      // Foca no input
      setTimeout(()=>fishName.focus(),150);

      // save handler
      saveBtn.onclick = ()=>{
        const name = fishName.value.trim();
        if(currentPreviewDataUrl){
          dataPaulistinha[currentId] = { name: name, image: currentPreviewDataUrl };
        } else if(name){
          dataPaulistinha[currentId] = { name: name };
        } else {
          delete dataPaulistinha[currentId];
        }
        writeToCellPaulistinha(currentId);
        saveToLocalPaulistinha();
        closeModal();
      };
    }

    function openModalGuppy(id, subtitleEl, imgEl){
      currentId = id;
      isPaulistinha = false;
      modalTitle.textContent = `Editar Tanque ${id.replace('G','')}`;
      fishName.value = (dataGuppy[id] && dataGuppy[id].name) ? dataGuppy[id].name : '';
      currentPreviewDataUrl = (dataGuppy[id] && dataGuppy[id].image) ? dataGuppy[id].image : null;
      renderPreview();
      fishImage.value = null;
      modal.classList.add('open');

      // Foca no input
      setTimeout(()=>fishName.focus(),150);

      // save handler
      saveBtn.onclick = ()=>{
        const name = fishName.value.trim();
        if(currentPreviewDataUrl){
          dataGuppy[currentId] = { name: name, image: currentPreviewDataUrl };
        } else if(name){
          dataGuppy[currentId] = { name: name };
        } else {
          delete dataGuppy[currentId];
        }
        writeToCellGuppy(currentId);
        saveToLocalGuppy();
        closeModal();
      };
    }

    function openModalBandeira(id, subtitleEl, imgEl){
      currentId = id;
      isPaulistinha = false;
      modalTitle.textContent = `Editar Tanque ${id.replace('B','')}`;
      fishName.value = (dataBandeira[id] && dataBandeira[id].name) ? dataBandeira[id].name : '';
      currentPreviewDataUrl = (dataBandeira[id] && dataBandeira[id].image) ? dataBandeira[id].image : null;
      renderPreview();
      fishImage.value = null;
      modal.classList.add('open');

      // Foca no input
      setTimeout(()=>fishName.focus(),150);

      // save handler
      saveBtn.onclick = ()=>{
        const name = fishName.value.trim();
        if(currentPreviewDataUrl){
          dataBandeira[currentId] = { name: name, image: currentPreviewDataUrl };
        } else if(name){
          dataBandeira[currentId] = { name: name };
        } else {
          delete dataBandeira[currentId];
        }
        writeToCellBandeira(currentId);
        saveToLocalBandeira();
        closeModal();
      };
    }

    function openModalCarpa(id, subtitleEl, imgEl){
      currentId = id;
      isPaulistinha = false;
      modalTitle.textContent = `Editar Tanque ${id.replace('C','')}`;
      fishName.value = (dataCarpa[id] && dataCarpa[id].name) ? dataCarpa[id].name : '';
      currentPreviewDataUrl = (dataCarpa[id] && dataCarpa[id].image) ? dataCarpa[id].image : null;
      renderPreview();
      fishImage.value = null;
      modal.classList.add('open');

      // Foca no input
      setTimeout(()=>fishName.focus(),150);

      // save handler
      saveBtn.onclick = ()=>{
        const name = fishName.value.trim();
        if(currentPreviewDataUrl){
          dataCarpa[currentId] = { name: name, image: currentPreviewDataUrl };
        } else if(name){
          dataCarpa[currentId] = { name: name };
        } else {
          delete dataCarpa[currentId];
        }
        writeToCellCarpa(currentId);
        saveToLocalCarpa();
        closeModal();
      };
    }

    function openModalBeta(id, subtitleEl, imgEl){
      currentId = id;
      isPaulistinha = false;
      modalTitle.textContent = `Editar Tanque ${id.replace('BT','')}`;
      fishName.value = (dataBeta[id] && dataBeta[id].name) ? dataBeta[id].name : '';
      currentPreviewDataUrl = (dataBeta[id] && dataBeta[id].image) ? dataBeta[id].image : null;
      renderPreview();
      fishImage.value = null;
      modal.classList.add('open');

      // Foca no input
      setTimeout(()=>fishName.focus(),150);

      // save handler
      saveBtn.onclick = ()=>{
        const name = fishName.value.trim();
        if(currentPreviewDataUrl){
          dataBeta[currentId] = { name: name, image: currentPreviewDataUrl };
        } else if(name){
          dataBeta[currentId] = { name: name };
        } else {
          delete dataBeta[currentId];
        }
        writeToCellBeta(currentId);
        saveToLocalBeta();
        closeModal();
      };
    }

    cancelBtn.onclick = ()=> closeModal();
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

    function closeModal(){ modal.classList.remove('open'); currentId = null; currentPreviewDataUrl = null; fishImage.value = null; }

    // Quando usuário seleciona arquivo, converte em dataURL (local)
    fishImage.addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = function(ev){ currentPreviewDataUrl = ev.target.result; renderPreview(); };
      reader.readAsDataURL(f);
    });

    function renderPreview(){
      imagePreview.innerHTML = '';
      if(currentPreviewDataUrl){
        const i = document.createElement('img'); i.src = currentPreviewDataUrl; imagePreview.appendChild(i);
      } else {
        imagePreview.textContent = 'Sem imagem';
      }
    }

    // atualiza célula na tela a partir do data
    function writeToCell(id){
      const cell = document.querySelector(`.cell[data-id='${id}']`);
      if(!cell) return;
      const subtitle = cell.querySelector('.subtitle');
      const img = cell.querySelector('img');
      if(data[id] && data[id].name) subtitle.textContent = data[id].name; else subtitle.textContent = '— (vazio)';
      if(data[id] && data[id].image){ img.src = data[id].image; img.style.display='block'; } else { img.src=''; img.style.display='none'; }
    }

    // atualiza célula Paulistinha
    function writeToCellPaulistinha(id){
      const cell = document.querySelector(`.cell[data-id='${id}']`);
      if(!cell) return;
      const subtitle = cell.querySelector('.subtitle');
      const img = cell.querySelector('img');
      if(dataPaulistinha[id] && dataPaulistinha[id].name) subtitle.textContent = dataPaulistinha[id].name; else subtitle.textContent = '— (vazio)';
      if(dataPaulistinha[id] && dataPaulistinha[id].image){ img.src = dataPaulistinha[id].image; img.style.display='block'; } else { img.src=''; img.style.display='none'; }
    }

    // atualiza célula Guppy
    function writeToCellGuppy(id){
      const cell = document.querySelector(`.cell[data-id='${id}']`);
      if(!cell) return;
      const subtitle = cell.querySelector('.subtitle');
      const img = cell.querySelector('img');
      if(dataGuppy[id] && dataGuppy[id].name) subtitle.textContent = dataGuppy[id].name; else subtitle.textContent = '— (vazio)';
      if(dataGuppy[id] && dataGuppy[id].image){ img.src = dataGuppy[id].image; img.style.display='block'; } else { img.src=''; img.style.display='none'; }
    }

    // atualiza célula Bandeira
    function writeToCellBandeira(id){
      const cell = document.querySelector(`.cell[data-id='${id}']`);
      if(!cell) return;
      const subtitle = cell.querySelector('.subtitle');
      const img = cell.querySelector('img');
      if(dataBandeira[id] && dataBandeira[id].name) subtitle.textContent = dataBandeira[id].name; else subtitle.textContent = '— (vazio)';
      if(dataBandeira[id] && dataBandeira[id].image){ img.src = dataBandeira[id].image; img.style.display='block'; } else { img.src=''; img.style.display='none'; }
    }

    // atualiza célula Carpa
    function writeToCellCarpa(id){
      const cell = document.querySelector(`.cell[data-id='${id}']`);
      if(!cell) return;
      const subtitle = cell.querySelector('.subtitle');
      const img = cell.querySelector('img');
      if(dataCarpa[id] && dataCarpa[id].name) subtitle.textContent = dataCarpa[id].name; else subtitle.textContent = '— (vazio)';
      if(dataCarpa[id] && dataCarpa[id].image){ img.src = dataCarpa[id].image; img.style.display='block'; } else { img.src=''; img.style.display='none'; }
    }

    // atualiza célula Beta
    function writeToCellBeta(id){
      const cell = document.querySelector(`.cell[data-id='${id}']`);
      if(!cell) return;
      const subtitle = cell.querySelector('.subtitle');
      const img = cell.querySelector('img');
      if(dataBeta[id] && dataBeta[id].name) subtitle.textContent = dataBeta[id].name; else subtitle.textContent = '— (vazio)';
      if(dataBeta[id] && dataBeta[id].image){ img.src = dataBeta[id].image; img.style.display='block'; } else { img.src=''; img.style.display='none'; }
    }

    // salva todo data no localStorage
    function saveToLocal(){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }catch(e){ alert('Erro ao salvar localmente. Talvez a imagem seja muito grande.'); }
    }

    // salva Paulistinha no localStorage
    function saveToLocalPaulistinha(){
      try{ localStorage.setItem(STORAGE_KEY_PAULISTINHA, JSON.stringify(dataPaulistinha)); }catch(e){ alert('Erro ao salvar localmente. Talvez a imagem seja muito grande.'); }
    }

    // salva Guppy no localStorage
    function saveToLocalGuppy(){
      try{ localStorage.setItem(STORAGE_KEY_GUPPY, JSON.stringify(dataGuppy)); }catch(e){ alert('Erro ao salvar localmente. Talvez a imagem seja muito grande.'); }
    }

    // salva Bandeira no localStorage
    function saveToLocalBandeira(){
      try{ localStorage.setItem(STORAGE_KEY_BANDEIRA, JSON.stringify(dataBandeira)); }catch(e){ alert('Erro ao salvar localmente. Talvez a imagem seja muito grande.'); }
    }

    // salva Carpa no localStorage
    function saveToLocalCarpa(){
      try{ localStorage.setItem(STORAGE_KEY_CARPA, JSON.stringify(dataCarpa)); }catch(e){ alert('Erro ao salvar localmente. Talvez a imagem seja muito grande.'); }
    }

    // salva Beta no localStorage
    function saveToLocalBeta(){
      try{ localStorage.setItem(STORAGE_KEY_BETA, JSON.stringify(dataBeta)); }catch(e){ alert('Erro ao salvar localmente. Talvez a imagem seja muito grande.'); }
    }

    // Se havia dados no loaded, atualiza células
    Object.keys(data).forEach(k=>writeToCell(k));
    Object.keys(dataPaulistinha).forEach(k=>writeToCellPaulistinha(k));
    Object.keys(dataGuppy).forEach(k=>writeToCellGuppy(k));
    Object.keys(dataBandeira).forEach(k=>writeToCellBandeira(k));
    Object.keys(dataCarpa).forEach(k=>writeToCellCarpa(k));
    Object.keys(dataBeta).forEach(k=>writeToCellBeta(k));

    // dica: você pode me mandar mais fotos/blocos que eu adiciono outras páginas/abas
  </script>
</body>
</html>
